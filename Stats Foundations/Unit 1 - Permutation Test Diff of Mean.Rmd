---
title: "HW1 - Class Poll Permutation"
date: 2018-11-11
tags: Statistics, R, Hypothesis Testing, Permutation Test
keywords: rlanguage, hypothesis testing, data science
output: html_notebook
---

## Homework 4 Questions on Class Poll Permutation test
A Business Stats class here at SMU was polled, and students were asked how much money (cash) they had in their pockets at that very moment.  The idea was to see if there was evidence that those in charge of the vending machines should include the expensive bill / coin acceptor or if the machines should just have the credit card reader. Also, a professor from Seattle University polled her class last year with the same question.  Below are the results of the polls.  

![](https://imagesvc.timeincapp.com/v3/mm/image?url=https%3A%2F%2Ftimedotcom.files.wordpress.com%2F2016%2F08%2F160817_mil_avoidtaxes.jpg&w=700&q=85)

*Andrew Richâ€”Getty Images*


```{r}
# SMU and Seattle University poll results
smu = c(34, 1200, 23, 50, 60, 50, 0, 0, 30, 89, 0, 300, 400, 20, 10, 0)
sea = c(20, 10, 5, 0, 30, 50, 0, 100, 110, 0, 40, 10, 3, 0)

# plot histograms for distribution
par(mfrow = c(1, 2)) # split the plot
hist(smu)
hist(sea)
```
From the histogram on the provided polls from SMU and Seattle U, immediately we the distributions of both observations vary quite drastically in terms of scale. We can see SMU has 3 outliers (1200, 300, 400) that would then increase the mean in comparison to the Seattle U's population mean. The evidence that we gather to determine this observation was the spread of SMU's histogram bars in comparison to Seattle U's spread of histogram bars.

### Summary Statistics
```{r}
cat("\n Summary Statistics for SMU: \n")
summary(smu)

cat("\n Summary Statistics for Seattle University: \n")
summary(sea)
```

#### Data Formatting
Currently we have two list of datasets, which we are tasked with performing a permutation test for our hypothesis. Prior to performing the test, lets create a dataframe for the dataset and indicate the two treatment groups `(1= SMU, 0 = Seattle)`
```{r}
# create list of college name for our reference 
college_name <- c(rep("smu", length(smu)), rep("sea", length(sea)))

# create binary dummy data to categorize the college_name string
treatment_group <- c(rep(0, length(smu)), rep(1, length(sea)))

# create list of polls results to be stored in one group
result <- c(smu, sea)

# create dataframe
poll <- data.frame(college_name, treatment_group, result)
head(poll)
```

```{r}
# print summary statistics
summary(poll)
```


## Permutation Test for the Difference between Two Means

### State the Hypothesis
Null Hypothesis: Ho: mu(smu) - mu(sea) = 0
Alternative Hypothesis: Ha: mu(smu) - mu(sea) != 0


### create test statistic
Since we are interested in the difference in means, we will create a test statistic variable to indicate the differences in college student pocket dollar amount.

```{r}
diff_mean <- mean(smu) - mean(sea)
diff_mean
```

Great! The interpetation of this result mean that college students have $114.63 more in their pocket if they attended SMU.


### Permuting the treatment group and results

```{r}
# set the seed to reproducability
set.seed(567)


# specify the number of permutations requred for the permutation test
nperm <- 10000

# create vector to hold average mean values during permutation test
perm_result <- numeric(0)

for(i in 1:nperm)
{
  scramble <- sample(poll$result,30); # indicate population of participants in poll
  smu_ <- scramble[1:16];             # randomly assign SMU group
  sea_ <- scramble[17:30];            # randomly assign SMU group
  diff <- mean(smu_)-mean(sea_);      # compute difference in sample means
  perm_result[i] <- diff;             # assign differnce in mean to the result vector
  
}
# Source: for loop code used from professors example on permutation
# .. test example for the creativity study
# .. which has been modifided for use of this study

cat("Number of values greater than the observed mean difference: ", sum(abs(perm_result) > diff_mean))
```


```{r}
# create a dataframe for plotting purposes to include a title for mean differend
# ... we'll do this to indicate in the plot legend the value of the mean different test statistic
observed_mean_diff_df <- data.frame(obs_mean="Observed Mean Difference", vals = diff_mean)

# create histogram to visulaize the distribution of the permutation test
library(ggplot2)
perm_plot <- ggplot(data=as.data.frame(perm_result), aes(perm_result)) + 
        geom_histogram(binwidth = 10, fill = barfill, colour = barlines) + 
        xlab("Permutation of the Means") + 
        ylab("Frequency of the Permutation Menas Test") +
        ggtitle("HW1 - Distribution of the Permutation Test between SMU and Seattle University Dollar Amount Means") +
        geom_vline(data = observed_mean_diff_df, aes(xintercept=diff_mean, color = "blue"))

# plot the permutation histogram
perm_plot
```

Plot similar histogram just only accounting for absolute values.
```{r}
perm_plot_absolute <- ggplot(data=as.data.frame(abs(perm_result)), aes(abs(perm_result))) + 
        geom_histogram(binwidth = 10, fill = barfill, colour = barlines) + 
        xlab("Permutation of the Means") + 
        ylab("Frequency of the Permutation Menas Test") +
        ggtitle("HW1 - Hist 2 of Distribution of the Permutation (Absolute Values)") +
        geom_vline(data = observed_mean_diff_df, aes(xintercept=diff_mean, color = "blue"))

# plot the permutation histogram (absolute)
perm_plot_absolute
```



Print the p-value which is the number of more extreme permutation result from the test (values > origial observed difference `114.63`) over the total number of random permutations.
```{r}
pvalue <- sum(abs(perm_result) > diff_mean) / nperm
cat("the pvalue from this permutation test is: ", pvalue)
```
